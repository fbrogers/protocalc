<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Business Value Calculator</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://assets.sdes.ucf.edu/cdn/minerva/v1.0.0-beta/css/minerva.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/style.css" />

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="assets/data.js"></script>
    <script>
        $(function(){
            var json = data;
            var jsonHtml = "";
            $.each(json.categories, function(key, category){
                jsonHtml += '<div class="card mb-3">';
                jsonHtml += '<div class="card-header"><b>'+ category.name + "</b> ";
                jsonHtml += '<span class="badge badge-success">' + category.weight + '</span>';
                jsonHtml += '</div>';
                jsonHtml += '<div class="card-body">';

                $.each(category.questions, function(key, question){
                    var questionWeight = Math.round(category.weight * (question.weight / 100));

                    jsonHtml += '<div class="form-group">';
                    jsonHtml += '<label>' + question.text + ' ';
                    jsonHtml += '<span class="qweight badge badge-warning">' + questionWeight + '</span> ';
                    jsonHtml += '<span class="qscore badge badge-success"></span>';
                    jsonHtml += '</label>';
                    jsonHtml += '<select class="form-control" size="' + question.answers.length + '">';

                    $.each(question.answers, function(key, answer){
                        jsonHtml += '<option value="' + key + '">' + answer.text + '</option>';
                    });

                    jsonHtml += '</select>';
                    jsonHtml += '</div>';
                });

                jsonHtml += '</div>';
                jsonHtml += '</div>';
            });
            $("#calcform").html(jsonHtml);

            function calcScore(){
                var score = 0;
                $(".qscore").each(function(){
                    score += Math.round($(this).text());
                });
                scoreRounded = Math.round(score * 0.2)

                $("#score").html(score + " / 100");
                $("#scoreRounded").html(scoreRounded + " / 20");
            }

            function reset(){
                $("option:selected").prop("selected", false);
                $(".qscore").html("0");
                calcScore();
            }
            reset();

            $('.btn-reset').on("click", function(){
                reset();
            });

            $("#calcform select").on("change", function(){
                var questionScoreContainer = $(this).parent().find("span.qscore:first");
                var questionScoreWeight = $(this).parent().find("span.qweight:first").html();
                var questionScore = $(this).val();
                var questionScale = $(this).children().length - 1;
                var questionScoreCalc = Math.round(questionScoreWeight * (questionScore / questionScale));
                questionScoreContainer.html(questionScoreCalc);

                calcScore();
            });
        })
    </script>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to Main Content</a>
    <header>
        <nav class="navbar navbar-dark navbar-expand-lg fixed-top slim-nav slim-nav-dark">
            <div class="container">
                <a class="navbar-brand" href="#">Protocalc</a>
                <span class="navbar-text h3">
                    <span class="badge badge-primary" id="score"></span>
                    <span class="badge badge-success" id="scoreRounded"></span>
                    <button class="btn btn-sm btn-warning btn-reset">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </span>
            </div>
        </nav>
    </header>
    <div class="container site-content my-5">
        <form id="calcform"></form>
    </div>
</body>
</html>
